"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getImages = void 0;
const base64_1 = require("./base64");
const getImages = async (frame) => {
    const data = {};
    await frame.waitForFunction(() => {
        const wrapperLoaded = document.querySelector('.task-image .image');
        const imagesLoaded = [];
        document
            .querySelectorAll('.task-image .image')
            .forEach(img => imagesLoaded.push(img.style.background.includes('url')));
        return wrapperLoaded && imagesLoaded.every(i => i);
    });
    const images = await frame.$$('.task-image');
    if (!images)
        throw new Error('getImages: no images found');
    for (const [index, img] of images.entries()) {
        const value = await img.$eval('.image', el => getComputedStyle(el).getPropertyValue('background'));
        const url = /url\("(.*)"/.exec(value);
        if (!url)
            throw new Error('getImages: no image url found');
        data[index] = await (0, base64_1.getBase64)(url[1]);
    }
    return data;
};
exports.getImages = getImages;
